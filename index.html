<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>インサイドセールス診断（12問）</title>
  <meta name="description" content="12問で、いま止まっているIS工程を1つに絞って可視化します。">
  <style>
    :root{--bg:#0b0f19;--card:#111827;--muted:#9ca3af;--text:#e5e7eb;--accent:#60a5fa;--border:#1f2937;--danger:#fca5a5;--ok:#86efac;}
    *{box-sizing:border-box} body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,"Hiragino Sans","Noto Sans JP","Segoe UI",Arial;background:linear-gradient(180deg,#070a12,#0b0f19 28%,#070a12);color:var(--text)}
    .wrap{max-width:1020px;margin:0 auto;padding:26px 18px 80px}
    .card{background:rgba(17,24,39,.92);border:1px solid var(--border);border-radius:16px;padding:16px}
    header.card{padding:18px}
    h1{font-size:22px;margin:0 0 10px}
    .lead{margin:0;color:var(--muted);line-height:1.7}
    .row{display:flex;gap:12px;flex-wrap:wrap;margin-top:14px}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;background:rgba(96,165,250,.12);border:1px solid rgba(96,165,250,.25);color:var(--text);font-size:12px}
    .pill b{color:var(--accent)}
    .sectionTitle{margin:18px 0 10px;font-size:16px}
    .fieldGrid{display:grid;grid-template-columns:1fr;gap:10px;margin-top:10px}
    @media(min-width:720px){.fieldGrid{grid-template-columns:1fr 1fr}}
    .field{display:flex;flex-direction:column;gap:6px}
    .field label{font-size:12px;color:var(--muted)}
    .field input,.field select{padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:rgba(3,7,18,.35);color:var(--text);outline:none}
    .grid{display:grid;grid-template-columns:1fr;gap:14px;margin-top:12px}
    .qhead{display:flex;gap:10px;align-items:flex-start}
    .qno{width:44px;height:44px;border-radius:12px;display:flex;align-items:center;justify-content:center;background:rgba(96,165,250,.14);border:1px solid rgba(96,165,250,.25);color:var(--accent);font-weight:900}
    .qtext{font-size:15px;line-height:1.65;margin-top:2px}
    .opts{display:grid;grid-template-columns:1fr;gap:8px;margin-top:12px}
    @media(min-width:720px){.opts{grid-template-columns:1fr 1fr}}
    label.opt{display:flex;gap:10px;align-items:center;padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:rgba(3,7,18,.35);cursor:pointer}
    label.opt:hover{border-color:rgba(96,165,250,.35)}
    input[type=radio]{transform:scale(1.1)}
    .consent{margin-top:10px;display:flex;gap:10px;align-items:flex-start}
    .muted{color:var(--muted);line-height:1.7}
    .actions{display:flex;gap:10px;align-items:center;margin-top:16px;flex-wrap:wrap}
    button{appearance:none;border:0;border-radius:12px;padding:12px 14px;background:var(--accent);color:#06101f;font-weight:900;cursor:pointer}
    button.secondary{background:transparent;border:1px solid rgba(96,165,250,.35);color:var(--text)}
    .hint{color:var(--muted);font-size:13px}
    .err{color:var(--danger)}
    .ok{color:var(--ok)}
    .result{margin-top:18px}
    .badge{display:inline-flex;align-items:center;gap:8px;padding:7px 11px;border-radius:999px;background:rgba(96,165,250,.14);border:1px solid rgba(96,165,250,.25);color:var(--accent);font-weight:900}
    .resBlock{margin-top:10px;padding:12px;border-radius:14px;border:1px solid var(--border);background:rgba(3,7,18,.35)}
    .resBlock h3{margin:0 0 6px;font-size:15px}
    .resBlock p{margin:0;line-height:1.75}
    .cta{margin-top:12px;display:flex;gap:10px;flex-wrap:wrap}
    a.ctaBtn{display:inline-flex;align-items:center;justify-content:center;padding:12px 14px;border-radius:12px;background:var(--accent);color:#06101f;font-weight:900;text-decoration:none}
    a.ctaBtn.secondary{background:transparent;border:1px solid rgba(96,165,250,.35);color:var(--text)}
  </style>
</head>
<body>
<div class="wrap">
  <header class="card">
    <h1>インサイドセールス診断（12問 / 1分）</h1>
    <p class="lead">点数ではなく、いま止まっている工程を1つに絞って言い切ります。回答はスプレッドシートに直送されます。</p>
    <div class="row">
      <div class="pill"><b>送信先</b>：Google スプレッドシート</div>
      <div class="pill"><b>同点優先</b>：④→①→②→③</div>
      <div class="pill"><b>所要</b>：1分</div>
    </div>
  </header>

  <h2 class="sectionTitle">基本情報（結果表示の前に入力）</h2>
  <div class="card">
    <div class="fieldGrid">
      <div class="field">
        <label for="role">あなたの立場（必須）</label>
        <select id="role" required>
          <option value="">選択してください</option>
          <option value="leader">IS責任者 / マネージャー</option>
          <option value="member">IS担当者（SDR/BDR）</option>
          <option value="other">その他（マーケ/営業企画など）</option>
        </select>
      </div>
      <div class="field">
        <label for="company">会社名（任意）</label>
        <input id="company" placeholder="例）株式会社〇〇" />
      </div>
      <div class="field">
        <label for="name">お名前（任意）</label>
        <input id="name" placeholder="例）山崎 暢大" />
      </div>
      <div class="field">
        <label for="email">メールアドレス（必須）</label>
        <input id="email" type="email" placeholder="例）xxx@company.co.jp" required />
      </div>
    </div>
    <div class="consent">
      <input id="consent" type="checkbox" />
      <label for="consent" class="muted" style="margin-top:1px">診断結果の表示および、結果に基づくご案内のために入力情報を利用することに同意します。</label>
    </div>
    <p class="muted" style="margin:10px 0 0">※「結果を見る」を押すと、回答をスプレッドシートに送信してから結果を表示します。</p>
  </div>

  <h2 class="sectionTitle">診断（12問）</h2>
  <form id="diagnosisForm" class="grid" autocomplete="off"></form>

  <div class="actions">
    <button type="button" id="btnResult">結果を見る</button>
    <button type="button" class="secondary" id="btnReset">リセット</button>
    <span class="hint">※未回答・必須未入力・同意未チェックはエラー表示します</span>
  </div>

  <div id="result" class="result"></div>
</div>

<script>
/** ====== CONFIG ======
 * 1) 下の APPS_SCRIPT_WEBAPP_URL を、Apps Scriptの「ウェブアプリURL」に差し替えてください。
 * 2) BOOKING_URL は商談予約URL（設定済み）
 */
const APPS_SCRIPT_WEBAPP_URL = "PASTE_YOUR_APPS_SCRIPT_WEBAPP_URL_HERE";
const BOOKING_URL = "https://meetings.immedio.io/date_select/nurturing_consulting?uk=bJkbljnfDukCjSlBrAyh#calendar";

const OPTIONS = [
  { value: "yes", label: "当てはまる" },
  { value: "yes", label: "どちらかというと当てはまる" },
  { value: "no",  label: "あまり当てはまらない" },
  { value: "no",  label: "当てはまらない" },
];

const QUESTIONS = [
  { id:"q1", point:"p1", title:"問い合わせ・資料請求が入った際、「この顧客は今すぐ話すべきか」を明確に判断できていないことがある" },
  { id:"q2", point:"p1", title:"インバウンドリードが商談につながらなかった理由を、「温度感が低かった」で終わらせていることが多い" },
  { id:"q3", point:"p1", title:"後から振り返って、「この問い合わせ、本当は商談になったはずだ」と感じることがある" },
  { id:"q4", point:"p2", title:"複数のリードが同時にあると、「今、誰を優先すべきか」を明確な基準で判断できていない" },
  { id:"q5", point:"p2", title:"後から振り返って、「今じゃなかったリード」に時間を使っていたと感じることがある" },
  { id:"q6", point:"p2", title:"商談を打診するタイミングが、顧客状況ではなく担当者の判断や空き時間に左右されている" },
  { id:"q7", point:"p3", title:"顧客に連絡する際、「この会社はいま何に困っていそうか」を仮説として持てないことがある" },
  { id:"q8", point:"p3", title:"何をきっかけに声をかければいいか分からず、結果的に後回しになっているリードがある" },
  { id:"q9", point:"p4", title:"インサイドセールスの役割や、何を成果（KPI）とするのかが明確に言語化・共有できていない" },
  { id:"q10", point:"p4", title:"架電数・メール数など、「とりあえず量をやる」以外の成果につながる動き方を説明できていない" },
  { id:"q11", point:"p4", title:"商談数は一定数あるものの、来月・再来月にどれくらい商談パイプラインが積み上がるか見通せていない" },
  { id:"q12", point:"p4", title:"商談数が思うように伸びないとき、「何を変えれば良いか」がはっきり分からない状態になっている" },
];

const RESULT_COPY = {
  p1: { badge:"結果：① インバウンド商談化の取りこぼし型", state:"問い合わせ・資料請求は来ているのに、“今すぐ話すべき顧客”への初動が遅れたり、優先度を誤っている状態です。", core:"顧客の見極めと、即時のアプローチが同時にできていません。", todo:"“今話すべき顧客”を瞬時に見極め、そのまま商談打診までつなげる運用を作ること。", ctaText:"「見極め→即時打診」を30分で整理する" },
  p2: { badge:"結果：② 優先順位・タイミング迷子型", state:"ISは動いているのに、誰を・いつ追うべきかが定まらず、動きが分散している状態です。", core:"追う順番と、商談打診のタイミングが設計されていません。", todo:"優先順位とタイミングを、担当者の判断ではなく仕組みで決めること。", ctaText:"無駄な動きを減らす整理を30分で行う" },
  p3: { badge:"結果：③ 仮説が立てられず動けない型", state:"顧客の興味関心が見えず、「なぜ今連絡するのか」を作れずに止まっている状態です。", core:"仮説を立てるための顧客情報が不足しています。", todo:"顧客行動を起点に、「今話す理由」を持ってアプローチできる状態を作ること。", ctaText:"会話のきっかけを30分で整理する" },
  p4: { badge:"結果：④ IS責任者｜パイプラインが積み上がらない型", state:"ISは動いており商談も一定数あるものの、来月・再来月のパイプラインが見えない状態です。", core:"商談が生まれる前工程が設計されておらず、パイプラインが“積み上がる構造”になっていません。", todo:"誰を起点に、いつ、どれくらい商談が積み上がるかを設計・可視化すること。", ctaText:"パイプライン課題を30分で整理する" },
};

function el(tag, attrs={}, children=[]){
  const node=document.createElement(tag);
  Object.entries(attrs).forEach(([k,v])=>{ if(k==="class") node.className=v; else if(k==="html") node.innerHTML=v; else node.setAttribute(k,v); });
  children.forEach(c=>node.appendChild(c));
  return node;
}

function renderForm(){
  const form=document.getElementById("diagnosisForm");
  form.innerHTML="";
  QUESTIONS.forEach((q, idx)=>{
    const card=el("div",{class:"card"});
    const head=el("div",{class:"qhead"},[
      el("div",{class:"qno",html:`Q${idx+1}`}),
      el("div",{class:"qtext",html:q.title})
    ]);
    const opts=el("div",{class:"opts"});
    OPTIONS.forEach((o,j)=>{
      const id=`${q.id}_${j}`;
      const input=el("input",{type:"radio",name:q.id,id,value:o.value,required:"required"});
      const label=el("label",{class:"opt",for:id},[input,el("span",{html:o.label})]);
      opts.appendChild(label);
    });
    card.appendChild(head); card.appendChild(opts);
    form.appendChild(card);
  });
}

function validateHeader(){
  const role=document.getElementById("role").value.trim();
  const email=document.getElementById("email").value.trim();
  const consent=document.getElementById("consent").checked;
  if(!role) return "立場（必須）を選択してください。";
  if(!email) return "メールアドレス（必須）を入力してください。";
  if(!consent) return "同意チェックを入れてください。";
  if(APPS_SCRIPT_WEBAPP_URL.includes("PASTE_YOUR_APPS_SCRIPT_WEBAPP_URL_HERE")) return "設定が未完了です：Apps ScriptのウェブアプリURLを差し替えてください。";
  return "";
}

function computeResult(){
  const headerErr=validateHeader();
  if(headerErr) return { error: headerErr };

  const form=document.getElementById("diagnosisForm");
  const data=new FormData(form);
  const missing=QUESTIONS.filter(q=>!data.get(q.id));
  if(missing.length) return { error: `未回答が ${missing.length} 問あります。全て回答してください。` };

  const score={p1:0,p2:0,p3:0,p4:0};
  QUESTIONS.forEach(q=>{ if(data.get(q.id)==="yes") score[q.point]+=1; });

  const priority=["p4","p1","p2","p3"];
  let best="p3", bestScore=-1;
  priority.forEach(p=>{ if(score[p]>bestScore){ best=p; bestScore=score[p]; }});

  // build payload
  const payload={
    timestamp: new Date().toISOString(),
    role: document.getElementById("role").value.trim(),
    company: document.getElementById("company").value.trim(),
    name: document.getElementById("name").value.trim(),
    email: document.getElementById("email").value.trim(),
    result: best,
    p1: score.p1, p2: score.p2, p3: score.p3, p4: score.p4,
    answers: Object.fromEntries(QUESTIONS.map(q=>[q.id, data.get(q.id)])),
    page_url: location.href,
    user_agent: navigator.userAgent,
  };

  return { best, score, payload };
}

async function postToSheets(payload){
  // POST JSON; Apps Script will write it into the sheet
  const res = await fetch(APPS_SCRIPT_WEBAPP_URL, {
    method: "POST",
    mode: "cors",
    headers: { "Content-Type":"application/json" },
    body: JSON.stringify(payload),
  });
  if(!res.ok){
    const t = await res.text().catch(()=> "");
    throw new Error(`送信に失敗しました（HTTP ${res.status}）。${t}`);
  }
  const json = await res.json().catch(()=> ({}));
  if(json && json.status && json.status !== "ok"){
    throw new Error(`送信に失敗しました：${json.message || "unknown"}`);
  }
  return json;
}

function renderResult(res){
  const out=document.getElementById("result");
  if(res.error){
    out.innerHTML=`<div class="card"><div class="err"><b>エラー：</b>${res.error}</div></div>`;
    out.scrollIntoView({behavior:"smooth",block:"start"});
    return;
  }
  const copy=RESULT_COPY[res.best];
  out.innerHTML = `
    <div class="card">
      <div class="badge">${copy.badge}</div>
      <div class="resBlock" style="margin-top:12px"><h3>あなたの状態</h3><p>${copy.state}</p></div>
      <div class="resBlock"><h3>本質的な課題</h3><p>${copy.core}</p></div>
      <div class="resBlock"><h3>やるべきこと</h3><p>${copy.todo}</p></div>
      <div class="cta">
        <a class="ctaBtn" href="${BOOKING_URL}" target="_blank" rel="noopener">${copy.ctaText}</a>
        <a class="ctaBtn secondary" href="#" id="btnPrint">この結果を印刷（PDF保存）</a>
      </div>
      <div class="muted" style="margin-top:12px"><span class="ok"><b>送信済み：</b></span>回答はスプレッドシートに記録されました。</div>
    </div>
  `;
  document.getElementById("btnPrint").onclick = (e)=>{ e.preventDefault(); window.print(); };
  out.scrollIntoView({behavior:"smooth",block:"start"});
}

document.getElementById("btnResult").addEventListener("click", async ()=>{
  const out=document.getElementById("result");
  out.innerHTML = `<div class="card"><div class="muted">送信中…（数秒）</div></div>`;
  const res = computeResult();
  if(res.error){ renderResult(res); return; }
  try{
    await postToSheets(res.payload);
    renderResult(res);
  }catch(e){
    out.innerHTML = `<div class="card"><div class="err"><b>送信エラー：</b>${e.message}</div><div class="muted" style="margin-top:8px">Apps Scriptの公開設定（アクセス権）とURLを確認してください。</div></div>`;
    out.scrollIntoView({behavior:"smooth",block:"start"});
  }
});

document.getElementById("btnReset").addEventListener("click", ()=>{
  document.getElementById("diagnosisForm").reset();
  document.getElementById("result").innerHTML="";
  window.scrollTo({top:0,behavior:"smooth"});
});

renderForm();
</script>
</body>
</html>

<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>インサイドセールス診断（12問 / 1分）</title>
  <style>
    :root{
      --bg:#0b1220;
      --text:#e8eefc;
      --muted:#a8b3cc;
      --line:rgba(255,255,255,.12);
      --accent:#6aa7ff;
      --accent2:#4fd1c5;
      --shadow:0 10px 30px rgba(0,0,0,.35);
      --radius:16px;
      --font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans JP","Hiragino Sans","Hiragino Kaku Gothic ProN","Yu Gothic",Meiryo,Arial,sans-serif;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--font);
      background:radial-gradient(1200px 600px at 20% 10%, rgba(106,167,255,.18), transparent 55%),
                 radial-gradient(900px 500px at 80% 20%, rgba(79,209,197,.14), transparent 55%),
                 var(--bg);
      color:var(--text);
    }
    .wrap{max-width:980px;margin:0 auto;padding:28px 18px 60px;}
    .hero{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border: 1px solid var(--line);
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      padding: 22px 22px 18px;
    }
    h1{margin:0 0 10px;font-size:26px;letter-spacing:.3px;}
    .lead{margin:0 0 14px;color:var(--muted);line-height:1.6;font-size:14.5px;}
    .chips{display:flex;gap:10px;flex-wrap:wrap}
    .chip{
      font-size:12.5px;color:#dbe7ff;border:1px solid var(--line);
      padding:6px 10px;border-radius:999px;background: rgba(255,255,255,.04);
    }
    .progressWrap{display:flex;align-items:center;gap:10px;margin-top:10px;}
    .bar{
      height:10px;flex:1;border-radius:999px;background: rgba(255,255,255,.08);
      overflow:hidden;border:1px solid rgba(255,255,255,.10);
    }
    .bar>div{height:100%;width:0%;background: linear-gradient(90deg, var(--accent), var(--accent2));}
    .stage{font-size:12.5px;color:#dbe7ff;white-space:nowrap;}

    .main{margin-top:16px;display:grid;grid-template-columns:1fr;gap:14px;}
    .card{
      border-radius: var(--radius);
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
      padding: 18px;
    }
    .muted{color:var(--muted)}
    .qTitle{display:flex;align-items:flex-start;gap:10px;margin:4px 0 12px;}
    .qNo{
      min-width:42px;height:42px;border-radius:12px;
      background: rgba(106,167,255,.18);
      border: 1px solid rgba(106,167,255,.35);
      display:flex;align-items:center;justify-content:center;
      font-weight:700;color:#eaf2ff;
    }
    .qText{font-size:16px;line-height:1.6;margin:2px 0 0;}
    .opts{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:12px 0 10px;}
    @media (max-width:720px){.opts{grid-template-columns:1fr}h1{font-size:22px}}
    label.opt{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
      border-radius: 14px;
      padding: 12px;
      display:flex;gap:10px;align-items:flex-start;
      cursor:pointer;transition:.15s ease;min-height:54px;
    }
    label.opt:hover{transform: translateY(-1px); border-color: rgba(106,167,255,.35)}
    label.opt input{margin-top:4px}
    .optTxt{font-size:14px;line-height:1.5}
    .nav{display:flex;justify-content:space-between;gap:10px;margin-top:14px;}
    button{
      font-family:var(--font);
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
      color:var(--text);
      padding: 10px 14px;
      border-radius: 12px;
      cursor:pointer;
      transition:.15s ease;
      font-size: 14px;
    }
    button:hover{transform: translateY(-1px); border-color: rgba(106,167,255,.35)}
    button.primary{
      background: linear-gradient(90deg, rgba(106,167,255,.85), rgba(79,209,197,.75));
      border:none;color:#06101f;font-weight:700;
    }
    .err{
      color:#ffd0d0;border:1px solid rgba(255,107,107,.35);
      background: rgba(255,107,107,.08);
      padding:10px 12px;border-radius:12px;font-size:13.5px;line-height:1.5;
      margin-top:10px;display:none;
    }

    .fields{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px;}
    .fields .full{grid-column: 1 / -1}
    .field{display:flex;flex-direction:column;gap:6px;}
    .field label{font-size:12.5px;color:var(--muted)}
    input[type="text"], input[type="email"], select{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.14);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      outline: none;
      font-size: 14px;
    }
    input::placeholder{color: rgba(255,255,255,.45)}
    select{appearance:none}

    .consent{
      display:flex;gap:10px;align-items:flex-start;
      margin-top:12px;padding:10px 12px;border-radius:12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.03);
      color: var(--muted);
      font-size: 12.5px;
      line-height:1.6;
    }

    .badge{
      display:inline-flex;align-items:center;gap:8px;
      border-radius:999px;padding:6px 10px;font-size:12.5px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.14);
      color:#dbe7ff;width:fit-content;
    }
    .resTitle{font-size:18px;margin:8px 0 0;line-height:1.45;}
    .resultGrid{display:grid;grid-template-columns:1fr;gap:12px;margin-top:12px;}
    .resBlock{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.12);
      border-radius: 14px;
      padding: 12px 12px;
    }
    .resBlock h3{margin:0 0 6px;font-size:13px;color:#dbe7ff;letter-spacing:.2px;}
    .resBlock p{margin:0;color:var(--muted);font-size:13.5px;line-height:1.7;white-space:pre-wrap;}

    .ctaRow{
      display:flex;
      justify-content:center;
      gap:10px;
      flex-wrap:wrap;
      margin-top:14px;
    }
    a.btnlink{
      text-decoration:none;
      display:inline-flex;align-items:center;justify-content:center;
      padding:14px 18px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background: linear-gradient(90deg, rgba(255, 193, 7, .95), rgba(255, 107, 107, .85));
      color:#0b1220;
      font-size:15px;
      font-weight:800;
      min-width: 260px;
      box-shadow: 0 12px 28px rgba(0,0,0,.35);
      transition:.15s ease;
      text-align:center;
    }
    a.btnlink:hover{transform: translateY(-1px); filter: brightness(1.02);}

    footer{margin-top:18px;color: rgba(255,255,255,.35);font-size:12px;text-align:center;}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="hero">
      <h1>インサイドセールス診断（12問 / 1分）</h1>
      <p class="lead">
        12問に答えるだけで、いま最も改善インパクトが出やすいポイントを1つに整理します。<br/>
        結果はその場で表示されます（記録は任意）。
      </p>
      <div class="chips">
        <div class="chip">形式：1問ずつ</div>
        <div class="chip">出力：4つの改善ポイントのうち1つ</div>
      </div>

      <div class="progressWrap">
        <div class="bar"><div id="barFill"></div></div>
        <div class="stage" id="stageText">開始</div>
      </div>
    </div>

    <div class="main">
      <div class="card" id="screen"></div>
      <footer>※静的HTMLで動作します（GitHub Pages向け）。</footer>
    </div>
  </div>

<script>
/** =============================
 * 設定
 * ============================== */

// ★あなたの最新 /exec（反映済み）
const APPS_SCRIPT_WEBAPP_URL = "https://script.google.com/macros/s/AKfycbzCZVylU7vC0u-J5EFUTFBOTboGxVvfDTWdTPlpYQ3bzzNYlR-JvLMaKTeiNl2P9PTN/exec";

// 参考リンク
const REFERENCE_URL = "https://meetings.immedio.io/date_select/nurturing_consulting?uk=bJkbljnfDukCjSlBrAyh#calendar";

// 質問
const QUESTIONS = [
  { key:"q1", text:"問い合わせ・資料請求が入った直後、『今すぐ話すべき顧客』を明確に判断できないことがある", bucket:"p1" },
  { key:"q2", text:"インバウンドが商談につながらなかった理由を、『温度感が低かった』で終わらせていることが多い", bucket:"p1" },
  { key:"q3", text:"後から振り返って、『この問い合わせは本当は商談になったはず』と感じることがある", bucket:"p1" },

  { key:"q4", text:"複数リードが同時にあるとき、『今、誰を優先すべきか』を明確な基準で判断できていない", bucket:"p2" },
  { key:"q5", text:"後から振り返って、『今じゃなかったリード』に時間を使っていたと感じることがある", bucket:"p2" },
  { key:"q6", text:"商談を打診するタイミングが、顧客状況より担当者の判断や空き時間に左右されている", bucket:"p2" },

  { key:"q7", text:"顧客に連絡する際、『この会社はいま何に困っていそうか』を仮説として持てないことがある", bucket:"p3" },
  { key:"q8", text:"顧客の興味関心が掴めず、『なぜ今連絡するのか』の理由づけが難しい", bucket:"p3" },
  { key:"q9", text:"電話・メールの打ち手がワンパターンになり、次の一手が出てこないことがある", bucket:"p3" },

  { key:"q10", text:"インサイドセールスの役割や、何をKPIにすべきかが明確に決まっていない", bucket:"p4" },
  { key:"q11", text:"商談数は一定あるが、翌月以降につながるパイプラインが安定して積み上がらない", bucket:"p4" },
  { key:"q12", text:"架電数・メール数など『とりあえず量をやる』以外の再現性あるやり方が作れていない", bucket:"p4" },
];

const OPTIONS = [
  { label:"当てはまる", val:3 },
  { label:"どちらかというと当てはまる", val:2 },
  { label:"あまり当てはまらない", val:1 },
  { label:"当てはまらない", val:0 },
];

const RESULT_COPY = {
  p1: {
    badge: "① インバウンド初動の改善ポイント",
    title: "“今すぐ話すべき顧客”を見極め、初動で成果が出やすい状態に整える",
    state:
`インバウンドは一定入っている一方で、
「誰を・いつ・どの濃度で」追うかの判断がブレやすい局面です。
初動の見極めが整うと、商談数だけでなく歩留まりも安定します。`,
    next:
`次に伸ばすポイントは「見極め → 即時アプローチ」を一連で回すことです。

・商談化しやすい条件（シグナル）を定義する
・直後に短く確認できる“型”を用意する
・判断と打診をセットで運用に落とす`,
    cta: "改善の方向性をもう少し詳しく見る（参考）"
  },
  p2: {
    badge: "② 優先順位・タイミングの改善ポイント",
    title: "優先順位の基準を作り、迷いなく動ける状態に整える",
    state:
`リードはあるのに、優先判断に時間が取られたり、
追い方が分散して成果が安定しにくい局面です。
基準が決まると、アポ率とパイプラインの積み上がりが滑らかになります。`,
    next:
`次に伸ばすポイントは「誰を優先するか」を迷わない設計です。

・優先順位のルール（スコア/条件）を決める
・追う順番と間隔をテンプレ化する
・空き時間基準ではなく顧客シグナル起点に変える`,
    cta: "優先順位の決め方を確認する（参考）"
  },
  p3: {
    badge: "③ 仮説づくり・理由づけの改善ポイント",
    title: "顧客の関心に沿って、連絡する理由が自然に作れる状態に整える",
    state:
`打ち手がワンパターンになると、
「何を切り口に連絡するか」が難しくなりやすい局面です。
仮説の作り方が整うと、通電後の会話も自然に深まります。`,
    next:
`次に伸ばすポイントは「仮説 → 理由づけ → 質問」の流れです。

・顧客状況を推定する仮説テンプレを持つ
・仮説に沿った連絡理由（1行）を作る
・関心を確認する質問を1つ固定する`,
    cta: "仮説づくりの型を確認する（参考）"
  },
  p4: {
    badge: "④ 体制/KPI/パイプライン（責任者向け）",
    title: "ISの役割とKPIを整え、パイプラインが積み上がる設計にする",
    state:
`ISが動き始めるほど、役割・KPI・運用が曖昧だと
成果が属人化しやすくなります。
“何を積み上げるか”が決まると、改善が回り始めます。`,
    next:
`次に伸ばすポイントは「設計 → 型化 → 可視化」です。

・役割（誰に何を提供するか）を定義する
・KPIを“積み上がる指標”に寄せる
・量だけでなく、優先順位とナーチャリングの型を作る`,
    cta: "役割・KPI設計の観点を確認する（参考）"
  }
};

const screen = document.getElementById("screen");
const barFill = document.getElementById("barFill");
const stageText = document.getElementById("stageText");

const state = {
  step: 0,
  answers: {},
  header: { role:"", company:"", name:"", email:"" },
  consent: false
};

function setProgress(step){
  const total = QUESTIONS.length + 2;
  const current = Math.min(step, total);
  const pct = Math.round((current / total) * 100);
  barFill.style.width = pct + "%";
  if(step === 0) stageText.textContent = "開始";
  else if(step >=1 && step <= QUESTIONS.length) stageText.textContent = `進捗：${step}/${QUESTIONS.length}`;
  else if(step === QUESTIONS.length + 1) stageText.textContent = `進捗：${QUESTIONS.length+1}/${QUESTIONS.length+2}（基本情報）`;
  else stageText.textContent = `進捗：${QUESTIONS.length+2}/${QUESTIONS.length+2}（結果）`;
}

function el(tag, attrs={}, children=[]){
  const n = document.createElement(tag);
  Object.entries(attrs).forEach(([k,v])=>{
    if(k==="class") n.className=v;
    else if(k==="html") n.innerHTML=v;
    else if(k.startsWith("on") && typeof v==="function") n.addEventListener(k.slice(2), v);
    else n.setAttribute(k, v);
  });
  (children||[]).forEach(c=>n.appendChild(c));
  return n;
}

function escapeHtml(s){
  return String(s)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

function renderStart(){
  setProgress(0);
  screen.innerHTML = "";
  screen.appendChild(el("div",{class:"muted", html:
    "<b>この診断でわかること</b><br/>" +
    "・いま詰まっているポイント（4つのうちどれか1つ）<br/>" +
    "・明日から変えるべき“最小の一手”"
  }));
  screen.appendChild(el("div",{style:"height:10px"}));
  screen.appendChild(el("div",{class:"nav"},[
    el("button",{class:"primary", onclick:()=>{state.step=1; render();}},[document.createTextNode("診断をはじめる")])
  ]));
}

function renderQuestion(idx){
  const q = QUESTIONS[idx-1];
  setProgress(idx);
  screen.innerHTML = "";

  screen.appendChild(el("div",{class:"qTitle"},[
    el("div",{class:"qNo", html:`Q${idx}`}),
    el("div",{class:"qText", html: escapeHtml(q.text)})
  ]));

  const opts = el("div",{class:"opts"});
  OPTIONS.forEach((o)=>{
    const id = `${q.key}_${o.val}`;
    const radio = el("input",{type:"radio", name:q.key, id, value:String(o.val)});
    if(state.answers[q.key] === o.val) radio.checked = true;

    const lab = el("label",{class:"opt", for:id},[
      radio,
      el("div",{class:"optTxt", html: escapeHtml(o.label)})
    ]);

    lab.addEventListener("click", ()=>{
      state.answers[q.key] = o.val;
      document.querySelectorAll(`input[name="${q.key}"]`)
        .forEach(r=>r.checked = (r.value===String(o.val)));
    });

    opts.appendChild(lab);
  });

  const err = el("div",{class:"err", id:"errBox"},[document.createTextNode("この質問に回答してください。")]);

  screen.appendChild(opts);
  screen.appendChild(err);

  screen.appendChild(el("div",{class:"nav"},[
    el("button",{onclick:()=>{
      if(idx===1){state.step=0;} else {state.step=idx-1;}
      render();
    }},[document.createTextNode("戻る")]),
    el("button",{class:"primary", onclick:()=>{
      if(typeof state.answers[q.key] !== "number"){
        document.getElementById("errBox").style.display="block";
        return;
      }
      state.step = (idx===QUESTIONS.length) ? (QUESTIONS.length + 1) : (idx + 1);
      render();
    }},[document.createTextNode(idx===QUESTIONS.length ? "基本情報へ" : "次へ")]),
  ]));
}

function renderHeader(){
  setProgress(QUESTIONS.length + 1);
  screen.innerHTML = "";
  screen.appendChild(el("div",{class:"muted", html:"<b>基本情報</b><br/>結果の表示前に入力してください（必須項目のみでOK）。"}));

  const fields = el("div",{class:"fields"},[
    el("div",{class:"field full"},[
      el("label",{html:"あなたの立場（必須）"}),
      (() => {
        const s = el("select",{},[
          el("option",{value:"", html:"選択してください"}),
          el("option",{value:"leader", html:"IS責任者 / マネージャー"}),
          el("option",{value:"sdr", html:"IS担当者（SDR/BDR）"}),
          el("option",{value:"other", html:"その他（マーケ/営業企画など）"}),
        ]);
        s.value = state.header.role || "";
        s.addEventListener("change", ()=> state.header.role = s.value);
        return s;
      })()
    ]),
    el("div",{class:"field"},[
      el("label",{html:"会社名（任意）"}),
      (() => {
        const i = el("input",{type:"text", placeholder:"会社名"});
        i.value = state.header.company || "";
        i.addEventListener("input", ()=> state.header.company = i.value);
        return i;
      })()
    ]),
    el("div",{class:"field"},[
      el("label",{html:"お名前（任意）"}),
      (() => {
        const i = el("input",{type:"text", placeholder:"山田 太郎"});
        i.value = state.header.name || "";
        i.addEventListener("input", ()=> state.header.name = i.value);
        return i;
      })()
    ]),
    el("div",{class:"field full"},[
      el("label",{html:"メールアドレス（必須）"}),
      (() => {
        const i = el("input",{type:"email", placeholder:"taro.yamada@example.com"});
        i.value = state.header.email || "";
        i.addEventListener("input", ()=> state.header.email = i.value);
        return i;
      })()
    ]),
  ]);

  const consent = el("div",{class:"consent"},[
    (() => {
      const c = el("input",{type:"checkbox"});
      c.checked = state.consent;
      c.addEventListener("change", ()=> state.consent = c.checked);
      return c;
    })(),
    el("div",{html:"回答内容を、（任意の）診断改善・分析のために記録してよい"})
  ]);

  const err = el("div",{class:"err", id:"headerErr"},[document.createTextNode("必須項目（立場・メールアドレス）を入力してください。")]);

  screen.appendChild(fields);
  screen.appendChild(consent);
  screen.appendChild(err);

  screen.appendChild(el("div",{class:"nav"},[
    el("button",{onclick:()=>{state.step=QUESTIONS.length; render();}},[document.createTextNode("戻る")]),
    el("button",{class:"primary", onclick:()=>{
      const okRole = !!state.header.role;
      const okEmail = !!state.header.email && state.header.email.includes("@");
      if(!okRole || !okEmail){
        document.getElementById("headerErr").style.display="block";
        return;
      }
      state.step = QUESTIONS.length + 2;
      render();
    }},[document.createTextNode("結果を見る")]),
  ]));
}

function computeBest(){
  const score = { p1:0, p2:0, p3:0, p4:0 };
  QUESTIONS.forEach(q=>{
    const v = state.answers[q.key];
    score[q.bucket] += (typeof v==="number" ? v : 0);
  });
  const order = ["p4","p1","p2","p3"];
  let best = order[0];
  order.forEach(k=>{ if(score[k] > score[best]) best = k; });
  return { best, score };
}

function buildPayload(best, score){
  const now = new Date();
  const answers = {};
  QUESTIONS.forEach(q=> answers[q.key] = state.answers[q.key]);
  return {
    timestamp: now.toISOString(),
    role: state.header.role || "",
    company: state.header.company || "",
    name: state.header.name || "",
    email: state.header.email || "",
    consent: !!state.consent,
    result: best,
    score,
    answers,
    page_url: location.href,
    user_agent: navigator.userAgent
  };
}

/* ★確実にGASへ届く：hidden form送信（CORS不要） */
function trySendToSheet(payload){
  if(!APPS_SCRIPT_WEBAPP_URL) return;

  let iframe = document.getElementById("sheetSenderFrame");
  if(!iframe){
    iframe = document.createElement("iframe");
    iframe.name = "sheetSenderFrame";
    iframe.id = "sheetSenderFrame";
    iframe.style.display = "none";
    document.body.appendChild(iframe);
  }

  const form = document.createElement("form");
  form.method = "POST";
  form.action = APPS_SCRIPT_WEBAPP_URL;
  form.target = "sheetSenderFrame";

  const input = document.createElement("input");
  input.type = "hidden";
  input.name = "payload";
  input.value = JSON.stringify(payload);

  form.appendChild(input);
  document.body.appendChild(form);

  form.submit();
  form.remove();
}

function resetAll(){
  state.step = 0;
  state.answers = {};
  state.header = { role:"", company:"", name:"", email:"" };
  state.consent = false;
  render();
}

function renderResult(){
  setProgress(QUESTIONS.length + 2);
  screen.innerHTML = "";

  const { best, score } = computeBest();
  const copy = RESULT_COPY[best];

  screen.appendChild(el("div",{class:"badge", html: escapeHtml(copy.badge)}));
  screen.appendChild(el("div",{class:"resTitle", html: escapeHtml(copy.title)}));

  const grid = el("div",{class:"resultGrid"},[
    el("div",{class:"resBlock"},[
      el("h3",{html:"現在の状況"}),
      el("p",{html: escapeHtml(copy.state)})
    ]),
    el("div",{class:"resBlock"},[
      el("h3",{html:"次に伸ばすポイント"}),
      el("p",{html: escapeHtml(copy.next)})
    ]),
  ]);
  screen.appendChild(grid);

  const ctaRow = el("div",{class:"ctaRow"},[
    (REFERENCE_URL ? el("a",{class:"btnlink", href:REFERENCE_URL, target:"_blank", rel:"noopener"},[
      document.createTextNode(copy.cta)
    ]) : el("span",{class:"muted", html:""}))
  ]);
  screen.appendChild(ctaRow);

  screen.appendChild(el("div",{style:"margin-top:10px; text-align:center;"},[
    el("button",{onclick:()=>resetAll()},[document.createTextNode("もう一度診断する")])
  ]));

  if(REFERENCE_URL){
    screen.appendChild(el("div",{class:"muted", html:"※上のリンクは参考情報です。結果を見るだけでもOKです。"}));
  }

  // 同意がONのときだけ送信
  if(state.consent && APPS_SCRIPT_WEBAPP_URL){
    const payload = buildPayload(best, score);
    trySendToSheet(payload);
  }
}

function render(){
  if(state.step === 0) return renderStart();
  if(state.step >= 1 && state.step <= QUESTIONS.length) return renderQuestion(state.step);
  if(state.step === QUESTIONS.length + 1) return renderHeader();
  return renderResult();
}

render();
</script>
</body>
</html>
